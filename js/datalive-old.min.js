$(document).ready(function(){var b={};b.numpoints=60;b.chart={};b.dataUpdateIntervalSecs=65;b.data={};b.selectedSensor="pressure";$("input[id=radio-default]").attr("checked",true);b.colours={pressure:"#009933",temperature:"#e81010",flowmag:"#0099cc",flowdir:"#6633cc",salinity:"#c71585",oxygen:"#ee6000",chlorophyll:"#808000",turbidity:"#a0522d",acoustic:"#707070"};b.sensorName={pressure:"Pressure",temperature:"Temperature",flowmag:"Flow speed",flowdir:"Flow direction",salinity:"Salinity",oxygen:"Oxygen concentration",chlorophyll:"Chlorophyll",turbidity:"Turbidity",acoustic:"Hydrophone"};b.sensorUnits={pressure:"kPa",temperature:"°C",flowmag:"cm/s",flowdir:"° re. mag. north",salinity:"PSU",oxygen:"uMol",chlorophyll:"ug/l",turbidity:"NTU",acoustic:"dB re. 1uPa@1m"};b.jqc={};b.jqc.div={};b.jqc.div.pressure=$("#pressure-toggle-button");b.jqc.div.temperature=$("#temperature-toggle-button");b.jqc.div.flowmag=$("#flow-toggle-button");b.jqc.div.flowdir=$("#flowdir-toggle-button");b.jqc.div.turbidity=$("#turbidity-toggle-button");b.jqc.div.acoustic=$("#acoustic-toggle-button");b.jqc.div.salinity=$("#salinity-toggle-button");b.jqc.div.oxygen=$("#oxygen-toggle-button");b.jqc.div.chlorophyll=$("#chlorophyll-toggle-button");b.jqc.cb={};b.jqc.cb.pressure=$("#checkboxPressure");b.jqc.cb.temperature=$("#checkboxTemperature");b.jqc.cb.flowmag=$("#checkboxFlow");b.jqc.cb.flowdir=$("#checkboxFlowDir");b.jqc.txt={};b.jqc.txt.togglehint=$("#toggle-group-hint");b.jqc={};b.jqc.img={};b.jqc.img.camimage=$("#camimage");b.jqc.txt={};b.jqc.txt.camimageTitle=$("#camimage-title");b.jqc.txt.tableheading=$("#table-heading");b.jqc.txt.tblPressure=$("#tbl-pressure");b.jqc.txt.tblTemperature=$("#tbl-temperature");b.jqc.txt.tblSalinity=$("#tbl-salinity");b.jqc.txt.tblOxy=$("#tbl-oxy");b.jqc.txt.tblTurbidity=$("#tbl-turbidity");b.jqc.txt.tblAcoustic=$("#tbl-acoustic");b.jqc.txt.tblChloro=$("#tbl-chloro");b.jqc.txt.tblFlowspd=$("#tbl-flowspd");b.jqc.txt.tblFlowdir=$("#tbl-flowdir");$("input[name=radio-plot]").change(function(){b.selectedSensor=$(this).val();f()});Date.prototype.AddSeconds=function(i){this.setSeconds(this.getSeconds()+i,this.getMilliseconds());return this};function e(i){var k,j;k=i;k=k.replace(/\D/g," ");j=k.split(" ");j[1]--;return new Date(Date.UTC(j[0],j[1],j[2],j[3],j[4],j[5]))}function h(m){var l=0,k=0;for(;l<b.data.time.length;l++){if(m<=b.data.time[l]){break}}if(l==0){k=0}else{if(Math.abs(b.data.time[l]-m)<Math.abs(b.data.time[l-1]-m)){k=l}else{k=l-1}}return k}g();function g(){var i="/logdata/2015-01-01T00:00:00Z/2015-01-01T00:00:01Z/"+b.numpoints+"?callback=?";$.getJSON(i,function(j){b.serverDatasets=j.datasets;c(j,null);a();setTimeout(function(){g()},b.dataUpdateIntervalSecs*1000);setTimeout(f,0);setTimeout(function(){d(b.data.time[b.data.time.length-1])},0)})}function c(k,l){var j;b.datasetsInRange=k.datasets;dt=e(k.startdate);dt_ms=dt.getTime();b.data.time=k.seconds;for(j=0;j<b.data.time.length;j++){b.data.time[j]=dt_ms+b.data.time[j]*1000}b.data.phototime=k.photos;for(j=0;j<b.data.phototime.length;j++){b.data.phototime[j]=dt_ms+b.data.phototime[j]*1000}for(sensor in b.colours){b.data[sensor]=$.map(b.data.time,function(m,i){return[[m,k[sensor][i]/100]]})}if(l!=null){setTimeout(l,0)}}function d(m){var i,j,k,l;i=h(m);j=b.data.phototime[i];k=Highcharts.dateFormat("SmallImage--%Y-%m-%d--%H-%M-%S--UTC.jpg",j);l=new Image();l.src="/image/"+k;if(l.complete){(b.jqc.img.camimage).attr("src",l.src);(b.jqc.txt.camimageTitle).text(Highcharts.dateFormat("%Y-%m-%dT%H:%M:%SZ",j))}else{l.onerror=function(){(b.jqc.txt.camimageTitle).text("Could not retrieve image");(b.jqc.img.camimage).attr("src","img/camera_image_not_available.jpg")};l.onload=function(){(b.jqc.img.camimage).attr("src",this.src);if((this.src).indexOf("not_available")>=0){(b.jqc.txt.camimageTitle).text("Sorry, the image for this data set is not currently available")}else{(b.jqc.txt.camimageTitle).text(Highcharts.dateFormat("%Y-%m-%dT%H:%M:%SZ",j))}}}}function a(){var m,n,i,q,r,l,k,p,j,o;m=new Date(b.data.time[b.data.time.length-1]);(b.jqc.txt.tableheading).text("This page updates automatically once per minute. The latest readings were acquired on "+m.toUTCString());n=b.data.pressure[b.data.pressure.length-1][1];i=b.data.temperature[b.data.temperature.length-1][1];q=b.data.salinity[b.data.salinity.length-1][1];r=b.data.oxygen[b.data.oxygen.length-1][1];l=b.data.turbidity[b.data.turbidity.length-1][1];k=b.data.acoustic[b.data.acoustic.length-1][1];p=b.data.chlorophyll[b.data.chlorophyll.length-1][1];j=b.data.flowmag[b.data.flowmag.length-1][1];o=b.data.flowdir[b.data.flowdir.length-1][1];(b.jqc.txt.tblPressure).text(n.toFixed(2));(b.jqc.txt.tblTemperature).text(i.toFixed(2));(b.jqc.txt.tblSalinity).text(q.toFixed(2));(b.jqc.txt.tblOxy).text(r.toFixed(2));(b.jqc.txt.tblTurbidity).text(l.toFixed(2));(b.jqc.txt.tblAcoustic).text(k.toFixed(2));(b.jqc.txt.tblChloro).text(p.toFixed(2));(b.jqc.txt.tblFlowspd).text(j.toFixed(2));(b.jqc.txt.tblFlowdir).text(o.toFixed(2));(b.jqc.txt.tableheading).attr("class","alert alert-success pagination-centered");setTimeout(function(){(b.jqc.txt.tableheading).attr("class","alert pagination-centered")},2000)}function f(){if($.isEmptyObject(b.chart)==false){b.chart.destroy()}b.chart=new Highcharts.Chart({chart:{renderTo:"highcharts-container",type:"spline",marginRight:10},title:{text:b.sensorName[b.selectedSensor]+" ("+b.sensorUnits[b.selectedSensor]+")",style:{color:"#003145"}},credits:{enabled:false},colors:[b.colours[b.selectedSensor]],xAxis:{type:"datetime"},yAxis:{title:{text:null,style:{color:b.colours[b.selectedSensor]}},labels:{align:"left",x:8,y:-4,style:{color:b.colours[b.selectedSensor]}},lineColor:b.colours[b.selectedSensor],lineWidth:1,offset:0},tooltip:{formatter:function(){return Highcharts.dateFormat("%A, %b %d, %H:%M:%S UTC",this.x)+'<br/><span style="color:'+this.series.color+'; font-weight:bold;">'+b.sensorName[b.selectedSensor]+"</span>  <b>"+Highcharts.numberFormat(this.y,2)+"</b> "+b.sensorUnits[b.selectedSensor]}},legend:{enabled:false},exporting:{enabled:false},series:[{name:b.sensorName[b.selectedSensor]+" ("+b.sensorUnits[b.selectedSensor]+")",data:b.data[b.selectedSensor]}]})}});